<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="dgvncsz0f">
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

        <title>Environment - leela-2.0.0-40-g7958539</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">leela-2.0.0-40-g7958539</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">User <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../user/http-interface">Http interface</a>
                            </li>
                        
                            <li >
                                <a href="../../user/leela-query-language">Leela query language</a>
                            </li>
                        
                            <li >
                                <a href="../../user/zeromq-interface">Zeromq interface</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Devel <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../architecture">Architecture</a>
                            </li>
                        
                            <li class="active">
                                <a href=".">Environment</a>
                            </li>
                        
                            <li >
                                <a href="..">Home</a>
                            </li>
                        
                            <li >
                                <a href="../network-protocol">Network protocol</a>
                            </li>
                        
                            <li >
                                <a href="../security">Security</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Admin <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../admin/install-cassandra">Install cassandra</a>
                            </li>
                        
                            <li >
                                <a href="../../admin/install-consul">Install consul</a>
                            </li>
                        
                            <li >
                                <a href="../../admin/install-leela">Install leela</a>
                            </li>
                        
                            <li >
                                <a href="../../admin/install-redis">Install redis</a>
                            </li>
                        
                            <li >
                                <a href="../../admin/packaging-leela">Packaging leela</a>
                            </li>
                        
                            <li >
                                <a href="../../admin/tuning-leela">Tuning leela</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                
                <li >
                    <a rel="next" href="../architecture">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="..">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#prepare-the-environment">PREPARE THE ENVIRONMENT</a></li>
        
            <li><a href="#libleela">LIBLEELA</a></li>
        
            <li><a href="#libleela-python">LIBLEELA-PYTHON</a></li>
        
            <li><a href="#libleela-ruby">LIBLEELA-RUBY</a></li>
        
            <li><a href="#warpdrivewarpgrep">WARPDRIVE|WARPGREP</a></li>
        
            <li><a href="#blackbox">BLACKBOX</a></li>
        
    
        <li class="main "><a href="#client-libraries">CLIENT LIBRARIES</a></li>
        
            <li><a href="#libleela_1">LIBLEELA</a></li>
        
            <li><a href="#libleela-python_1">LIBLEELA-PYTHON</a></li>
        
            <li><a href="#libleela-ruby_1">LIBLEELA-RUBY</a></li>
        
            <li><a href="#collectd">COLLECTD</a></li>
        
    
        <li class="main "><a href="#warpdrive">WARPDRIVE</a></li>
        
    
        <li class="main "><a href="#blackbox_1">BLACKBOX</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>Leela is a multi-language project and getting the development
environment right is not a trivial task. But fear not my friend, much
has been done to make this task simpler.</p>
<p>There are many ways of achieving this but in this document we have
decided to use docker <sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup>. Docker allows you to
create and manage linux containers [well, it actually is much more
than that, but it is outside the scope of this document to go into
further details], which we will use to create an isolated
environment where we can compile, test and execute Leela.</p>
<p>Lets first clone the project:</p>
<pre><code class="bash">$ git clone git://github.com/locaweb/leela.git
$ cd leela
</code></pre>

<p>We can now create the docker images we need. To see what images are
available, issue the command with no arguments.</p>
<pre><code class="bash">$ sudo ./automation/docker/makeimg.sh debian7.amd64
</code></pre>

<p>Notice there are more images available. Just issue the same command
without arguments in order to know what is available. For instance,
there are centos images available too.</p>
<p>This may take a while, but after it is done you should be able to see
a new container available:</p>
<pre><code>$ sudo docker images
REPOSITORY             TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
leela/debian7-amd64    latest              2e01277ea2ca        6 hours ago         525.1 MB
</code></pre>
<p>This complete the foundation. From here it really depends on what you
want to do. Each component has its own set of dependencies and the
following sections details each one of them. However, without going
into much detail, this table summarizes what needs to be done:</p>
<table>
<thead>
<tr>
<th>component</th>
<th>bootstrap-scripts</th>
</tr>
</thead>
<tbody>
<tr>
<td>libleela</td>
<td>zeromq-bootstrap.sh</td>
</tr>
<tr>
<td>libleela-python</td>
<td>zeromq-bootstrap.sh</td>
</tr>
<tr>
<td></td>
<td>python-bootstrap.sh</td>
</tr>
<tr>
<td>libleela-ruby</td>
<td>zeromq-bootstrap.sh</td>
</tr>
<tr>
<td></td>
<td>ruby-bootstrap.sh</td>
</tr>
<tr>
<td>collectd</td>
<td>zeromq-bootstrap.sh</td>
</tr>
<tr>
<td></td>
<td>collectd-bootstrap.sh</td>
</tr>
<tr>
<td>warpdrive</td>
<td>zeromq-bootstrap.sh</td>
</tr>
<tr>
<td></td>
<td>haskell-bootstrap.sh</td>
</tr>
<tr>
<td>blackbox</td>
<td>zeromq-bootstrap.sh</td>
</tr>
<tr>
<td></td>
<td>clojure-bootstrap.sh</td>
</tr>
<tr>
<td>warpgrep</td>
<td>zeromq-bootstrap.sh</td>
</tr>
<tr>
<td></td>
<td>haskell-bootstrap.sh</td>
</tr>
</tbody>
</table>
<p>Notice that you must prepare the environment according to the next
section before compiling or testing the modules.</p>
<h1 id="prepare-the-environment">PREPARE THE ENVIRONMENT</h1>
<p>This section contains what must be done to prepare the environment for
compiling Leela. Each module gets its own section and its
self-contained and the title matches the names in the following
sections.</p>
<h2 id="libleela">LIBLEELA</h2>
<pre><code class="bash">debian7.amd64 $ /leela/automation/bootstrap/zeromq-bootstrap.sh
</code></pre>

<h2 id="libleela-python">LIBLEELA-PYTHON</h2>
<pre><code class="bash">debian7.amd64 $ /leela/automation/bootstrap/python-bootstrap.sh
debian7.amd64 $ /leela/automation/bootstrap/zeromq-bootstrap.sh
</code></pre>

<h2 id="libleela-ruby">LIBLEELA-RUBY</h2>
<p>TODO:fixme</p>
<h2 id="warpdrivewarpgrep">WARPDRIVE|WARPGREP</h2>
<pre><code class="bash">debian7.amd64 $ /leela/automation/bootstrap/zeromq-bootstrap.sh
debian7.amd64 $ /leela/automation/bootstrap/haskell-bootstrap.sh
</code></pre>

<h2 id="blackbox">BLACKBOX</h2>
<pre><code class="bash">debian7.amd64 $ /leela/automation/bootstrap/zeromq-bootstrap.sh
debian7.amd64 $ /leela/automation/bootstrap/clojure-bootstrap.sh
</code></pre>

<h1 id="client-libraries">CLIENT LIBRARIES</h1>
<p>This section covers <em>libleela</em>, <em>libleela-python</em> and
__libleela-ruby_.</p>
<p>There is a <em>makefile</em> on <em>automation/devel</em> directory that has code to
compile the libraries on linux. This <em>makefile</em> uses two importante
variables when building:</p>
<ul>
<li>
<p><code>buildroot</code>: the directory to store build generated
  files. Defaults to <em>/tmp/leela/build</em>;</p>
</li>
<li>
<p><code>distroot</code>: the installation directory. Defaults to
  <em>/tmp/leela/dist</em>;</p>
</li>
</ul>
<p>Since these directories are not standard the linker will probably fail
to find libraries. The same goes for Python. For this reason, there is
a simple script that defines a couple of environment variables that
enables you to use this non standard path:</p>
<pre><code class="bash">debian7.amd64 $ env distroot=/tmp/leela/dist \
                  /leela/automation/devel/envleela COMMAND
</code></pre>

<p>Just keep in mind that you must use the very same <code>distroot</code> to
build leela components as often the components depends on each other.</p>
<h2 id="libleela_1">LIBLEELA</h2>
<pre><code class="bash">$ sudo docker run \
         --rm \
         -i -t \
         -v $(pwd):/leela \
       leela/debian7-amd64 /bin/bash
debian7.amd64 $ /leela/automation/bootstrap/zeromq-bootstap.sh
debian7.amd64 $ make -C /leela/automation/devel compile.libleela
</code></pre>

<p>This should install files under the <code>distroot</code> directory:</p>
<pre><code class="bash">$ ls -1F /tmp/leela/dist/lib/
libleela.so@
libleela.so.6@
libleela.so.6.4.1
libpoly1305aes.a
</code></pre>

<h2 id="libleela-python_1">LIBLEELA-PYTHON</h2>
<pre><code class="bash">debian7.amd64 $ make -C /leela/automation/devel compile.libleela-python
</code></pre>

<p>This installs the <em>pyleela</em> python module:</p>
<pre><code class="bash">debian7.amd64 $ /leela/automation/devel/envleela python2 -c 'import pyleela.lql; print(&quot;ok&quot;);'
</code></pre>

<h2 id="libleela-ruby_1">LIBLEELA-RUBY</h2>
<p>TODO:fixme</p>
<h2 id="collectd">COLLECTD</h2>
<pre><code class="bash">debian7.amd64 $ make -C /leela/automation/devel compile.collectd
</code></pre>

<p>Which must produce the write_leela shared library:</p>
<pre><code class="bash">debian7.amd64 $ ls -1 /tmp/leela/lib/write_leela.so
/tmp/leela/lib/write_leela.so
</code></pre>

<h1 id="warpdrive">WARPDRIVE</h1>
<pre><code class="bash">debian7.amd64 $ make -C /leela/automation/devel compile.warpdrive
</code></pre>

<h1 id="blackbox_1">BLACKBOX</h1>
<pre><code class="bash">debian7.amd64 $ make -C /leela/automation/devel compile.blackbox
</code></pre>

</div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/prettify-1.0.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>