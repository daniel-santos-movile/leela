<!DOCTYPE HTML>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>leela chart</title>
    </head>
    <body>
    <form name="chart-it" method="get">
      <label for="endpoint">
        endpoint:
        <input id="endpoint" type="text" name="endpoint" />
      </label><br />
      <label for="key">
        key:
        <input id="key" type="text" name="key" />
      </label><br />
      <label for="resolution">
        resolution (min):
        <input id="resolution" type="text" name="resolution" value="30" />
      </label>
      <input type="submit" />
    </form>
    <span id="uri"></span></br>
    <div id="placeholder" style="height:600px; width: 800px; margin: 8px auto;"></div>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.2.js"></script>
    <script type="text/javascript" src="../leela/static/js/functions.js"></script>
    <script type="text/javascript" src="../leela/static/js/widget_flotr2.js"></script>
    <script type="text/javascript" src="../leela/static/js/flotr2.min.js"></script>

    <script type="text/javascript">
      var qparam = function (name, defval) {
        var r = new RegExp("[\\?&]"+ name + "=([^#&]*)");
        var m = r.exec(window.location.search);
        if(m === null)
          return(defval);
        else
          return(decodeURIComponent(m[1].replace(/\+/g, " ")));
      };
      var endpoint = qparam("endpoint");
      var key      = qparam("key");
      var res      = parseInt(qparam("resolution"));
      if (endpoint !== undefined && key !== undefined) {
        var uri = endpoint + "/v1/past24/"+ encodeURIComponent(key);
        jQuery("#uri").html("<a href='" + uri + "'>data url: "+ uri +"</a>");
        jQuery("#endpoint").val(endpoint);
        jQuery("#key").val(key);
        jQuery("#resolution").val(res);
        jQuery.ajax(uri,
          { dataType: "jsonp",
            success: LEELA.f.dot(LEELA.widget("placeholder", {resolution: res}).install, LEELA.f.average(res, 0))
          });
      }
    </script>
    </body>
</html>
